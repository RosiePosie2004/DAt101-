<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>Sonic Example</title>
    <style>
      .prevent-select {
        -webkit-user-select: none; /* Safari */
        -ms-user-select: none; /* IE 10 and IE 11 */
        user-select: none; /* Standard syntax */
      }
    </style>
    <!-- Import map: map the bare specifier "three" to the local module build. -->
    <script type="importmap">
      {
        "imports": {
          "libSprite": "../../common/script/libSprite.mjs",
          "lib2d": "../../common/script/lib2d.mjs"
        }
      }
    </script>
  </head>
  <body class="prevent-select">
    <canvas id="cvs" style="background-color: rgb(123, 213, 237)" width="1024" height="512"></canvas>
  </body>
  <script type="module"defer>
    // import libraries
    import { TSpriteCanvas, TSprite } from "libSprite";

     // prettier-ignore
  const SpriteInfoList = {
    sonic1: { x: 0, y:   0, width: 102, height: 125, count: 6},
    sonic2: { x: 0, y: 125, width: 102, height: 125, count: 9},
    sonic3: { x: 0, y: 250, width: 102, height: 125, count: 9},
    sonic4: { x: 0, y: 375, width: 102, height:  75, count: 7},
    sonic5: { x: 0, y: 450, width: 100, height: 130, count: 5},
    sonic6: { x: 0, y: 575, width: 102, height: 125, count: 3},
    sonic7: { x: 0, y: 700, width: 102, height: 125, count: 2},
    sonic8: { x: 0, y: 825, width: 102, height: 125, count: 2},
    sonic9: { x: 0, y: 950, width: 102, height: 125, count: 4}
  }

    // Global variables
    const cvs = document.getElementById("cvs");
    const ctx = cvs.getContext("2d");
    const spcvs = new TSpriteCanvas(cvs);
    const hero1 = new TSprite(spcvs, SpriteInfoList.sonic2, 0, 100);
    const hero2 = new TSprite(spcvs, SpriteInfoList.sonic5, 0, 300);
    const hero3 = new TSprite(spcvs, SpriteInfoList.sonic9, 400, 200);
    const hero4 = new TSprite(spcvs, SpriteInfoList.sonic4, 0, 20);
    const hero5 = new TSprite(spcvs, SpriteInfoList.sonic9, 200, 400);
    // Function 

    function drawCanvas() {
      // This is a high performance function
      // Do not do any heavy calculation here

      hero1.draw();
      hero2.draw();
      hero3.draw();
      hero4.draw(); 
      hero5.draw();
    }
    let dir = 1; // 1 = right, -1 = left
    let dir2 = 1;
    let dir3 = 1;
    let dir4 = 1;
    function animate(){
      hero1.x += 3 * dir;
      console.log(hero1.x) ;
      if((hero1.x > cvs.width - hero1.width) || (hero1.x + hero1.width < 0 && dir < 0)) {
        dir *= -1;
        hero.flipHorizontal();  
      }  
      hero2.x += 2 * dir2;
      console.log(hero2.x) ;
      if((hero2.x > cvs.width - hero2.width) || (hero2.x + hero2.width < 0 && dir2 < 0)) {
        dir2 *= -1;
        hero2.flipHorizontal(); 
      }
      hero3.x += 4 * dir3;
      console.log(hero3.x) ;
      if((hero3.x > cvs.width - hero3.width) || (hero3.x+ hero3.width < 0 && dir3 < 0)) {
          dir3 *= -1;
          hero3.flipHorizontal(); 
        } 
        hero4.x += 1 * dir4;
        console.log(hero4.x) ;
        if((hero4.x > cvs.width - hero4.width) || (hero4.x + hero4.width < 0 && dir4 < 0)) {
          dir4 *= -1;
          hero4.flipHorizontal(); 
        } 


    }

    function sheetLoaded() {
      console.log("Sheet loaded");
      spcvs.showFramerate = true;
      spcvs.onDraw = drawCanvas; 
      hero1.animationSpeed = 67;
      hero1.rotation = 90; 
      hero1.hidden = true;

      hero2.animationSpeed = 21; 
      hero2.hidden = true; 

      hero3.animationSpeed = 67; 
      hero3.hidden = true;

      hero4.animationSpeed = 100;
      hero4.hidden = true; 

      hero5.animationSpeed = 1;
    
      // Start animation setInterval(animate)
      setInterval(animate, 1 / 60);
    }
     function onKeyDown(aEvent) {
      switch(aEvent.code) { 
        case "ArrowUp": 
          hero5.y -= 10; 
          break; 
        case "ArrowDown": 
          hero5.y += 10; 
          break; 
        case "ArrowLeft": 
          hero5.x -= 10; 
          break; 
        case "ArrowRight": 
          hero5.x += 10; 
          break; 
      }
      
      }
    //Main application
    spcvs.loadSpriteImage("sonic_sprite_sheet.png",sheetLoaded);
    document.addEventListener("keydown", onKeyDown);
  </script>
</html>